@model PagedViewModel<Book>
@{
    ViewData["Title"] = "Index";
}

<main id="tg-main" class="tg-main tg-haslayout">
    <!--************************************
            Inner Banner Start
    *************************************-->
    <div class="tg-innerbanner tg-haslayout tg-parallax tg-bginnerbanner"
         data-z-index="-100"
         data-appear-top-offset="600"
         data-parallax="scroll"
         data-image-src=@Url.Content("~/assets/images/parallax/bgparallax-07.jpg")>
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="tg-innerbannercontent">
                        <h1>All Products</h1>
                        <ol class="tg-breadcrumb">
                            <li><a href="javascript:void(0);">home</a></li>
                            <li class="tg-active">Products</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--************************************
            Inner Banner End
    *************************************-->
    <!--************************************
                News Grid Start
        *************************************-->
    <div class="tg-sectionspace tg-haslayout">
        <div class="container">
            <div class="row">
                <div id="tg-twocolumns" class="tg-twocolumns">
                    <div class="col-xs-12 col-sm-8 col-md-8 col-lg-9 pull-right">
                        <div id="tg-content" class="tg-content">
                            <div class="tg-products">
                                <div class="tg-sectionhead">
                                    <h2><span>People’s Choice</span>Bestselling Books</h2>
                                </div>
                                <div class="tg-featurebook alert" role="alert">
                                    <button type="button"
                                            class="close"
                                            data-dismiss="alert"
                                            aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <div class="tg-featureditm">
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 hidden-sm hidden-xs">
                                                <figure>
                                                    <img src="~/assets/images/img-04.png"
                                                         alt="image description" />
                                                </figure>
                                            </div>
                                            <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
                                                <div class="tg-featureditmcontent">
                                                    <div class="tg-themetagbox">
                                                        <span class="tg-themetag">featured</span>
                                                    </div>
                                                    <div class="tg-booktitle">
                                                        <h3>
                                                            <a href="javascript:void(0);">Things To Know About Green Flat Design</a>
                                                        </h3>
                                                    </div>
                                                    <span class="tg-bookwriter">
                                                        By:
                                                        <a href="javascript:void(0);">Farrah Whisenhunt</a>
                                                    </span>
                                                    <span class="tg-stars"><span></span></span>
                                                    <div class="tg-priceandbtn">
                                                        <span class="tg-bookprice">
                                                            <ins>$23.18</ins>
                                                            <del>$30.20</del>
                                                        </span>
                                                        <a class="tg-btn tg-btnstyletwo tg-active"
                                                           href="javascript:void(0);">
                                                            <i class="fa fa-shopping-basket"></i>
                                                            <em>Add To Basket</em>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="products">
                                    <partial name="_Books" model="@Model" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 pull-left">
                        <aside id="tg-sidebar" class="tg-sidebar">
                            <div class="tg-widget tg-widgetsearch">
                                <form class="tg-formtheme tg-formsearch">
                                    <div class="form-group">
                                        <button type="submit">
                                            <i class="icon-magnifier"></i>
                                        </button>
                                        <input type="search"
                                               name="search"
                                               class="form-group"
                                               placeholder="Search by title, author, key..." />
                                    </div>
                                </form>
                            </div>
                            <div class="tg-widget">
                                @await Component.InvokeAsync("SearchPanel")
                            </div>
                            <div class="tg-widget tg-catagories">
                                <div class="tg-widgettitle">
                                    <h3>Categories</h3>
                                </div>
                                <div class="tg-widgetcontent">
                                    <ul>
                                        <li>
                                            <a href="javascript:void(0);">
                                                <span>Art &amp; Photography</span><em>28245</em>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Biography</span><em>4856</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Children’s Book</span><em>8654</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Craft &amp; Hobbies</span><em>6247</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);">
                                                <span>Crime &amp; Thriller</span><em>888654</em>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);">
                                                <span>Fantasy &amp; Horror</span><em>873144</em>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Fiction</span><em>18465</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Fod &amp; Drink</span><em>3148</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);">
                                                <span>Graphic, Anime &amp; Manga</span><em>77531</em>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>Science Fiction</span><em>9247</em></a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);"><span>View All</span></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="tg-widget tg-widgettrending">
                                <div class="tg-widgettitle">
                                    <h3>Trending Products</h3>
                                </div>
                                <div class="tg-widgetcontent">
                                    <ul>
                                        <li>
                                            <article class="tg-post">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/products/img-04.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-postcontent">
                                                    <div class="tg-posttitle">
                                                        <h3>
                                                            <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                        </h3>
                                                    </div>
                                                    <span class="tg-bookwriter">
                                                        By:
                                                        <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                    </span>
                                                </div>
                                            </article>
                                        </li>
                                        <li>
                                            <article class="tg-post">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/products/img-05.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-postcontent">
                                                    <div class="tg-posttitle">
                                                        <h3>
                                                            <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                        </h3>
                                                    </div>
                                                    <span class="tg-bookwriter">
                                                        By:
                                                        <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                    </span>
                                                </div>
                                            </article>
                                        </li>
                                        <li>
                                            <article class="tg-post">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/products/img-06.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-postcontent">
                                                    <div class="tg-posttitle">
                                                        <h3>
                                                            <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                        </h3>
                                                    </div>
                                                    <span class="tg-bookwriter">
                                                        By:
                                                        <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                    </span>
                                                </div>
                                            </article>
                                        </li>
                                        <li>
                                            <article class="tg-post">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/products/img-07.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-postcontent">
                                                    <div class="tg-posttitle">
                                                        <h3>
                                                            <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                        </h3>
                                                    </div>
                                                    <span class="tg-bookwriter">
                                                        By:
                                                        <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                    </span>
                                                </div>
                                            </article>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="tg-widget tg-widgetblogers">
                                <div class="tg-widgettitle">
                                    <h3>Top Bloogers</h3>
                                </div>
                                <div class="tg-widgetcontent">
                                    <ul>
                                        <li>
                                            <div class="tg-author">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/author/imag-03.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-authorcontent">
                                                    <h2>
                                                        <a href="javascript:void(0);">Jude Morphew</a>
                                                    </h2>
                                                    <span>21,658 Published Books</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="tg-author">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/author/imag-04.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-authorcontent">
                                                    <h2>
                                                        <a href="javascript:void(0);">Jude Morphew</a>
                                                    </h2>
                                                    <span>21,658 Published Books</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="tg-author">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/author/imag-05.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-authorcontent">
                                                    <h2>
                                                        <a href="javascript:void(0);">Jude Morphew</a>
                                                    </h2>
                                                    <span>21,658 Published Books</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="tg-author">
                                                <figure>
                                                    <a href="javascript:void(0);">
                                                        <img src="~/assets/images/author/imag-06.jpg"
                                                             alt="image description" />
                                                    </a>
                                                </figure>
                                                <div class="tg-authorcontent">
                                                    <h2>
                                                        <a href="javascript:void(0);">Jude Morphew</a>
                                                    </h2>
                                                    <span>21,658 Published Books</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--************************************
                News Grid End
        *************************************-->
</main>

@section addcss{
    <style>
                [data-entity-type] {
          position: relative;
          padding-left: 30px;
          display: block;
          cursor: pointer;
        }

        [data-entity-type]:not(.filled)::before {
          content: "";
          font-size: 0.7em;
          font-weight: 900;
          font-family: "Font Awesome 5 Free";
          position: absolute;
          border: 1px solid #cccccc85;
          width: 18px;
          height: 18px;
          border-radius: 2px;
          top: 50%;
          left: 0px;
          transform: translateY(-50%);
          text-align: center;
          text-indent: 1px;
          line-height: 1.7em;
        }

        [data-entity-type].active:not(.filled)::before {
          content: "\f00c";
          color: #ffffff;
          background-color: #cccccc85;
          border-color: #cccccc85;
        }

        [data-entity-type].filled {
          width: 30px;
          height: 25px;
          border-radius: 2px;
          border: 1px solid #cccccc85;
        }

        [data-entity-type].filled::before {
          content: "";
          display: inline-block;
          padding-left: 1px;
          line-height: 7pt;
          font-size: 5pt;
          font-weight: 900;
          font-family: "Font Awesome 5 Free";
          position: absolute;
          top: 1px;
          right: 1px;
        }

        [data-entity-type].filled.active::before {
          content: "\f00c";
          color: #000000c4;
          background-color: #ffffff;
          border: 1px solid #000000c4;
          width: 12px;
          height: 12px;
          border-radius: 100%;
        }

        #price-range[range]::before {
          content: attr(range);
          display: flex;
          justify-content: center;
          padding-top: 5px;
        }



    </style>
}

    @section addjs{
    <script>
        const priceRangeData = $("#price-range").data();

        const searchModel = {
            authors: [],
            publishers: [],
            languages: [],
            categories: [],
            min: priceRangeData.priceMin,
            max: priceRangeData.priceMax
        };

        $(document).ready(function() {
            $('.blog-pagination.ptb-20')
                .removeClass('blog-pagination')
                .removeClass('ptb-20')
                .addClass('list-inline');

            $("#price-range")
                .attr('range', `${searchModel.min}₼ - ${searchModel.max}₼`)
                .slider({
                    range: true,
                    min: searchModel.min,
                    max: searchModel.max,
                    values: [searchModel.min, searchModel.max],
                    slide: function(e, ui) {
                        $(e.target).attr('range', `${ui.values[0]}₼ - ${ui.values[1]}₼`);
                        searchModel.min = ui.values[0];
                        searchModel.max = ui.values[1];

                        filterProducts();
                    }
                });


            $('[data-entity-type]').click(function(e) {

                e.preventDefault();

                let model = $(e.currentTarget).data();  //entityType  id

                if ($(e.currentTarget).hasClass('active') == true) {
                    $(e.currentTarget).removeClass('active');
                    searchModel[`${model.entityType}`] = searchModel[`${model.entityType}`].filter(item => item != model.id);
                }
                else {
                    $(e.currentTarget).addClass('active');

                    if (searchModel[`${model.entityType}`].filter(item => item == model.id).length == 0) {
                        searchModel[`${model.entityType}`].push(model.id);
                    }
                }

                filterProducts();
            });
        });

        function filterProducts() {
            if ($.pid != undefined) {
                clearTimeout($.pid);
            }

            $.pid = setTimeout(function() {
                console.log(searchModel);

                $.ajax({
                    type: 'POST',
                    data: searchModel,
                    contentType: 'application/x-www-form-urlencoded',
                    success: function(response) {

                        $('#products').html(response);
                        console.log(response);
                    },
                    error: function(response) {
                        console.log(response);
                    }
                });
            }, 1500);
        }

        function addToFavorites(bookId) {
            const favorites = ($.cookie('favorites') || '').split(',').filter(item => item.length > 0);


            if (favorites.filter(item => item == bookId).length == 0) {
                favorites.push(bookId);

                $.cookie('favorites', favorites.toString(), { path: '/', expires: 7 })
            }

            console.log($.cookie('favorites'));
        }

        function addToBasket(e) {
            e.preventDefault();

            const elementData = $(e.currentTarget).data();

            $.ajax({
                url: `@Url.Action("Basket","Book")`,
                type: 'POST',
                data: elementData,
                contentType: 'application/x-www-form-urlencoded',
                success: function(response) {
                    if (response.error == false) {
                        $(e.target).closest('tr').remove();
                        toastr.success(response.message, 'Success');
                        return;
                    }


                    toastr.error(response.message, 'Error');
                },
                error: function(response, status, xhr) {
                    console.log(response, status, xhr);
                }
            });
        }
    </script>
}
