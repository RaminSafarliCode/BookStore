@model BlogPost
@{
    ViewData["Title"] = "Details";

    IEnumerable<BlogPostComment> GetComments(BlogPostComment parent)
    {
        if (parent.ParentId != null)
            yield return parent;

        foreach (var item in parent.Comments.SelectMany(c => GetComments(c)))
        {
            yield return item;
        }

    }
}

<!--************************************
                Inner Banner Start
        *************************************-->
<div class="tg-innerbanner tg-haslayout tg-parallax tg-bginnerbanner"
     data-z-index="-100"
     data-appear-top-offset="600"
     data-parallax="scroll"
     data-image-src=@Url.Content("~/assets/images/parallax/bgparallax-07.jpg")>
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="tg-innerbannercontent">
                    <h1>News &amp; Articles</h1>
                    <ol class="tg-breadcrumb">
                        <li><a asp-controller="home" asp-action="index">home</a></li>
                        <li><a asp-controller="blog" asp-action="index">news</a></li>
                        <li class="tg-active">@Model.Title.Substring(0, (Model.Title.Length < 20 ? Model.Title.Length : 20))...</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
<!--************************************
          Inner Banner End
  *************************************-->
<!--************************************
            News Grid Start
    *************************************-->
<div class="tg-sectionspace tg-haslayout">
    <div class="container">
        <div class="row">
            <div id="tg-twocolumns" class="tg-twocolumns">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <figure class="tg-newsdetailimg">
                        <img src="~/uploads/images/@Model.ImagePath" alt="blog-image">
                        <figcaption class="tg-author">
                            <div class="tg-authorinfo">
                                <span class="tg-bookwriter">
                                    By:
                                    <a href="javascript:void(0);">@Model.CreatedByUser?.Name @Model.CreatedByUser?.Surname</a>
                                </span>
                                <ul class="tg-postmetadata">
                                    <li>
                                        <a href="javascript:void(0);">
                                            <i class="fa fa-comment-o"></i><i>@Model.Comments.Count() Comments</i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><i class="fa fa-eye"></i><i>24,565 Views</i></a>
                                    </li>
                                </ul>
                            </div>
                        </figcaption>
                    </figure>
                </div>
                <div class="col-xs-12 col-sm-8 col-md-8 col-lg-9 pull-right">
                    <div id="tg-content" class="tg-content">
                        <div class="tg-newsdetail">
                            <ul class="tg-bookscategories">
                                <a href="javascript:void(0);">@Model.BlogPostCategory.Name</a>
                                @*<li><a href="javascript:void(0);">Fun</a></li>*@
                            </ul>
                            <div class="tg-themetagbox">
                                <span class="tg-themetag">featured</span>
                            </div>
                            <div class="tg-posttitle">
                                <h3>
                                    <a href="javascript:void(0);">@Model.Title</a>
                                </h3>
                            </div>
                            <div class="tg-description">
                                <p>@Html.Raw(Model.Body)</p>
                            </div>
                            <div class="tg-tagsshare">
                                <div class="tg-tags">
                                    <span>Tags:</span>
                                    <div class="tg-tagholder">
                                        @foreach (var item in Model.TagCloud)
                                        {
                                            <a class="tg-tag" href="javascript:void(0);">@item.Tag.Text</a>
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="tg-commentsarea comments">
                                <div class="tg-sectionhead">
                                    <h2>@Model.Comments.Count() Comments</h2>
                                </div>
                                <ul id="tg-comments" class="tg-comments">

                                    @foreach (var comment in Model.Comments.Where(c => c.ParentId == null))
                                    {

                                        <li class="comment" id="c-@comment.Id" data-comment-id="@comment.Id">
                                            <div class="tg-authorbox">
                                                <div class="tg-authorinfo">
                                                    <div class="tg-authorhead">
                                                        <div class="tg-leftarea">
                                                            <div class="tg-authorname">
                                                                <h2>@($"{comment.CreatedByUser?.Name} {comment.CreatedByUser?.Surname}")</h2>
                                                                <span>Author Since: June 27, 2017</span>
                                                            </div>
                                                        </div>
                                                        <div class="tg-rightarea">
                                                            <a class="tg-btnreply  btn-comment-reply"
                                                           href="javascript:void(0);">
                                                                Reply<i class="fa fa-mail-reply"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div class="tg-description">
                                                        <p>
                                                            @comment.Text
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="tg-bottomarrow"></div>
                                            </div>
                                        </li>

                                        @foreach (var subComment in GetComments(comment))
                                        {
                                            <li class="comment comment-sub" id="c-@subComment.Id" data-comment-id="@subComment.Id">
                                                <div class="tg-authorbox">
                                                    <div class="tg-authorinfo">
                                                        <div class="tg-authorhead">
                                                            <div class="tg-leftarea">
                                                                <div class="tg-authorname">
                                                                    <h2>@($"{subComment.CreatedByUser?.Name} {subComment.CreatedByUser?.Surname}")</h2>
                                                                    <span>Author Since: June 27, 2017</span>
                                                                </div>
                                                            </div>
                                                            <div class="tg-rightarea">
                                                                <a class="tg-btnreply btn-comment-reply"
                                                           href="javascript:void(0);">
                                                                    Reply<i class="fa fa-mail-reply"></i>
                                                                </a>
                                                            </div>
                                                        </div>
                                                        <div class="tg-description">
                                                            <p>
                                                                @subComment.Text
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="tg-bottomarrow"></div>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                            <div class="tg-leaveyourcomment">
                                <div class="tg-sectionhead">
                                    <h2>Leave Your Comment</h2>
                                </div>
                                <form method="post" class="tg-formtheme tg-formleavecomment" id="replyForm">
                                    <fieldset>
                                        <div id="replyToComment"></div>
                                        <input type="hidden" name="postId" value="@Model.Id" />
                                        @*<div class="form-group">
                                        <input type="text"
                                        name="full name"
                                        class="form-control"
                                        placeholder="First Name*" />
                                        </div>
                                        <div class="form-group">
                                        <input type="text"
                                        name="last name"
                                        class="form-control"
                                        placeholder="Last Name*" />
                                        </div>
                                        <div class="form-group">
                                        <input type="email"
                                        name="email address"
                                        class="form-control"
                                        placeholder="Email*" />
                                        </div>
                                        <div class="form-group">
                                        <input type="text"
                                        name="subject"
                                        class="form-control"
                                        placeholder="Subject (optional)" />
                                        </div>*@
                                        <div class="form-group">
                                            <textarea id="comment-text" name="comment" placeholder="Comment"></textarea>
                                        </div>
                                        <div class="form-group">
                                            @if (true)
                                            {
                                                <button type="submit" class="tg-btn tg-active">Submit</button>
                                            }
                                            else
                                            {
                                                <a asp-action="Signin" asp-controller="account" class="btn btn-dark">Sign in to comment on post</a>
                                            }
                                        </div>
                                    </fieldset>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 pull-left">
                    <aside id="tg-sidebar" class="tg-sidebar">
                        <div class="tg-widget tg-widgetsearch">
                            <form class="tg-formtheme tg-formsearch">
                                <div class="form-group">
                                    <button type="submit">
                                        <i class="icon-magnifier"></i>
                                    </button>
                                    <input type="search"
                                           name="search"
                                           class="form-group"
                                           placeholder="Search Here" />
                                </div>
                            </form>
                        </div>
                        <div class="tg-widget tg-catagories">
                            <div class="tg-widgettitle">
                                <h3>Categories</h3>
                            </div>
                            <div class="tg-widgetcontent">
                                <ul>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <span>Art &amp; Photography</span><em>28245</em>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Biography</span><em>4856</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Children’s Book</span><em>8654</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Craft &amp; Hobbies</span><em>6247</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <span>Crime &amp; Thriller</span><em>888654</em>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <span>Fantasy &amp; Horror</span><em>873144</em>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Fiction</span><em>18465</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Fod &amp; Drink</span><em>3148</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <span>Graphic, Anime &amp; Manga</span><em>77531</em>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>Science Fiction</span><em>9247</em></a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"><span>View All</span></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tg-widget tg-widgettrending">
                            <div class="tg-widgettitle">
                                <h3>Trending Posts</h3>
                            </div>
                            <div class="tg-widgetcontent">
                                <ul>
                                    <li>
                                        <article class="tg-post">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/products/img-04.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-postcontent">
                                                <div class="tg-posttitle">
                                                    <h3>
                                                        <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                    </h3>
                                                </div>
                                                <span class="tg-bookwriter">
                                                    By:
                                                    <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                </span>
                                            </div>
                                        </article>
                                    </li>
                                    <li>
                                        <article class="tg-post">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/products/img-05.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-postcontent">
                                                <div class="tg-posttitle">
                                                    <h3>
                                                        <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                    </h3>
                                                </div>
                                                <span class="tg-bookwriter">
                                                    By:
                                                    <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                </span>
                                            </div>
                                        </article>
                                    </li>
                                    <li>
                                        <article class="tg-post">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/products/img-06.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-postcontent">
                                                <div class="tg-posttitle">
                                                    <h3>
                                                        <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                    </h3>
                                                </div>
                                                <span class="tg-bookwriter">
                                                    By:
                                                    <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                </span>
                                            </div>
                                        </article>
                                    </li>
                                    <li>
                                        <article class="tg-post">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/products/img-07.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-postcontent">
                                                <div class="tg-posttitle">
                                                    <h3>
                                                        <a href="javascript:void(0);">Where The Wild Things Are</a>
                                                    </h3>
                                                </div>
                                                <span class="tg-bookwriter">
                                                    By:
                                                    <a href="javascript:void(0);">Kathrine Culbertson</a>
                                                </span>
                                            </div>
                                        </article>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tg-widget tg-widgetblogers">
                            <div class="tg-widgettitle">
                                <h3>Top Bloogers</h3>
                            </div>
                            <div class="tg-widgetcontent">
                                <ul>
                                    <li>
                                        <div class="tg-author">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/author/imag-03.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-authorcontent">
                                                <h2>
                                                    <a href="javascript:void(0);">Jude Morphew</a>
                                                </h2>
                                                <span>21,658 Published Books</span>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="tg-author">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/author/imag-03.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-authorcontent">
                                                <h2>
                                                    <a href="javascript:void(0);">Jude Morphew</a>
                                                </h2>
                                                <span>21,658 Published Books</span>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="tg-author">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/author/imag-03.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-authorcontent">
                                                <h2>
                                                    <a href="javascript:void(0);">Jude Morphew</a>
                                                </h2>
                                                <span>21,658 Published Books</span>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="tg-author">
                                            <figure>
                                                <a href="javascript:void(0);">
                                                    <img src="~/assets/images/author/imag-03.jpg"
                                                         alt="image description" />
                                                </a>
                                            </figure>
                                            <div class="tg-authorcontent">
                                                <h2>
                                                    <a href="javascript:void(0);">Jude Morphew</a>
                                                </h2>
                                                <span>21,658 Published Books</span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </div>
</div>
<!--************************************
            News Grid End
    *************************************-->
@section addcss{
    <style>
        .comment-sub {
            margin: 0;
            width: 100%;
            float: left;
            padding: 0 0 0 100px;
        }
    </style>
}

    @section addjs{
    <script>
        $(document).ready(function() {
            $(".btn-comment-reply").click(function(e) {
                e.preventDefault();

                $("#replyToComment").html("<a href='javascript:removeSelectedReply()' class='remove-selected-comment' >&times</a>").append($(e.currentTarget).closest(".comment").clone());

            })

            $("#replyForm").submit(function(e) {
                e.preventDefault();

                let formData = new FormData(e.currentTarget);
                let toCommentId = $(`#replyToComment li.comment`).data("comment-id");
                console.log("commentId", toCommentId);

                if (toCommentId != undefined) {
                    formData.set("commentId", toCommentId);
                }

                $.ajax({
                    url: `@Url.Action("PostComment", "Blog")`,
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    dataType: "json",
                    success: function(res) {
                        //console.log(res);
                    },
                    error: function(response) {

                        console.log("error var");
                        if (response.statusText == "OK") {
                            if (toCommentId != undefined) {
                                $(response.responseText).insertAfter($(`#c-${toCommentId}`));

                                $("#replyToComment").html("")
                                e.currentTarget.reset();
                                $("#comment-text").val("");
                            }
                            else {
                                $("div.comments ul").append($(response.responseText))
                                $("#comment-text").val("");
                            }
                        }

                        console.warn(response);
                    }
                });
            })
        })

        function removeSelectedReply(el) {
            $("#replyToComment").html("");
        }
    </script>
}

